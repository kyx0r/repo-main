#!/bin/sh -e

# Remove po/ dir.
sed "/subdir('po')/d" meson.build > _
mv -f _ meson.build

# Swap to shell script instead of perl script
# for conversion of rules files. See files/xml2lst.
sed -E "s/(xml2lst).pl/\1/" rules/meson.build > _
mv -f _ rules/meson.build

meson \
    --prefix=/usr \
    -D compat-rules=true \
    -D xorg-rules-symlinks=true \
    -D xkb-base="/usr/share/X11/xkb" \
    . output

ninja -C output
ninja -C output install
